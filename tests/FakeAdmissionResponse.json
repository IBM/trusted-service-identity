[
   {
      "op":"add",
      "path":"/metadata/annotations",
      "value":{
         "admission.trusted.identity/status":"mutated",
         "admission.trusted.identity/ti-cluster-name":"EUcluster",
         "admission.trusted.identity/ti-cluster-region":"eu-de",
         "admission.trusted.identity/ti-images":"trustedseriviceidentity/myubuntu@sha256:5b224e11f0e8daf35deb9aebc86218f1c444d2b88f89c57420a61b1b3c24584c"
      }
   },
   {
      "op":"add",
      "path":"/metadata/annotations",
      "value":{
         "admission.trusted.identity/status":"mutated",
         "admission.trusted.identity/ti-cluster-name":"EUcluster",
         "admission.trusted.identity/ti-cluster-region":"eu-de",
         "admission.trusted.identity/ti-images":"trustedseriviceidentity/myubuntu@sha256:5b224e11f0e8daf35deb9aebc86218f1c444d2b88f89c57420a61b1b3c24584c"
      }
   },
   {
      "op":"add",
      "path":"/metadata/annotations",
      "value":{
         "admission.trusted.identity/status":"imutated",
         "admission.trusted.identity/ti-cluster-name":"EUcluster",
         "admission.trusted.identity/ti-cluster-region":"eu-de",
         "admission.trusted.identity/ti-images":"trustedseriviceidentity/myubuntu@sha256:5b224e11f0e8daf35deb9aebc86218f1c444d2b88f89c57420a61b1b3c24584c"
      }
   },
   {
      "op":"add",
      "path":"/metadata/annotations",
      "value":{
         "admission.trusted.identity/status":"mutated",
         "admission.trusted.identity/ti-cluster-name":"EUcluster",
         "admission.trusted.identity/ti-cluster-region":"eu-de",
         "admission.trusted.identity/ti-images":"trustedseriviceidentity/myubuntu@sha256:5b224e11f0e8daf35deb9aebc86218f1c444d2b88f89c57420a61b1b3c24584c"
      }
   },
   {
      "op":"add",
      "path":"/metadata/annotations",
      "value":{
         "admission.trusted.identity/status":"mutated",
         "admission.trusted.identity/ti-cluster-name":"EUcluster",
         "admission.trusted.identity/ti-cluster-region":"eu-de",
         "admission.trusted.identity/ti-images":"trustedseriviceidentity/myubuntu@sha256:5b224e11f0e8daf35deb9aebc86218f1c444d2b88f89c57420a61b1b3c24584c"
      }
   },
   {
      "op":"add",
      "path":"/spec/initContainers",
      "value":[
         {
            "name":"gen-vault-cert",
            "image":"trustedseriviceidentity/ti-gen-vault-cert:v1.2",
            "resources":{

            },
            "volumeMounts":[
               {
                  "name":"pod-metadata",
                  "readOnly":true,
                  "mountPath":"/pod-metadata"
               },
               {
                  "name":"ti-sa-mount",
                  "readOnly":true,
                  "mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"
               },
               {
                  "name":"ti-vault-secret",
                  "mountPath":"/certs"
               },
               {
                  "name":"ti-keys",
                  "readOnly":true,
                  "mountPath":"/keys"
               },
               {
                  "name":"ti-skeys",
                  "readOnly":true,
                  "mountPath":"/skeys"
               },
               {
                  "name":"host-etc",
                  "readOnly":true,
                  "mountPath":"/host/etc"
               }
            ],
            "terminationMessagePath":"/dev/termination-log",
            "terminationMessagePolicy":"File",
            "imagePullPolicy":"Always"
         }
      ]
   },
   {
      "op":"add",
      "path":"/spec/containers/-",
      "value":{
         "name":"jwt-sidecar",
         "image":"trustedseriviceidentity/ti-jwt-sidecar:v1.2",
         "command":[
            "/bin/sh",
            "-c",
            "/usr/local/bin/execute-get-key.sh"
         ],
         "resources":{

         },
         "volumeMounts":[
            {
               "name":"jwt-shared-data",
               "mountPath":"/usr/share/secrets"
            },
            {
               "name":"jwt-configmap",
               "readOnly":true,
               "mountPath":"/configmap/jwt"
            },
            {
               "name":"jwt-secret",
               "readOnly":true,
               "mountPath":"/secret/jwt"
            },
            {
               "name":"pod-metadata",
               "readOnly":true,
               "mountPath":"/pod-metadata"
            },
            {
               "name":"host-etc",
               "mountPath":"/host/etc"
            }
         ],
         "imagePullPolicy":"Always"
      }
   },
   {
      "op":"add",
      "path":"/spec/volumes/-",
      "value":{
         "name":"jwt-shared-data",
         "emptyDir":{

         }
      }
   },
   {
      "op":"add",
      "path":"/spec/volumes/-",
      "value":{
         "name":"jwt-configmap",
         "configMap":{
            "name":"ti-jwt-configmap",
            "defaultMode":484
         }
      }
   },
   {
      "op":"add",
      "path":"/spec/volumes/-",
      "value":{
         "name":"ti-host-volume",
         "hostPath":{
            "path":"/ti",
            "type":"Directory"
         }
      }
   },
   {
      "op":"add",
      "path":"/spec/volumes/-",
      "value":{
         "name":"host-etc",
         "hostPath":{
            "path":"/etc",
            "type":"Directory"
         }
      }
   },
   {
      "op":"add",
      "path":"/spec/volumes/-",
      "value":{
         "name":"jwt-secret",
         "hostPath":{
            "path":"/ti/secrets/jwt",
            "type":"Directory"
         }
      }
   },
   {
      "op":"add",
      "path":"/spec/volumes/-",
      "value":{
         "name":"pod-metadata",
         "downwardAPI":{
            "items":[
               {
                  "path":"ti-identity",
                  "fieldRef":{
                     "apiVersion":"v1",
                     "fieldPath":"metadata.annotations['admission.trusted.identity/ti-identity']"
                  }
               },
               {
                  "path":"ti-pod-name",
                  "fieldRef":{
                     "apiVersion":"v1",
                     "fieldPath":"metadata.name"
                  }
               },
               {
                  "path":"ti-pod-namespace",
                  "fieldRef":{
                     "apiVersion":"v1",
                     "fieldPath":"metadata.namespace"
                  }
               },
               {
                  "path":"ti-images",
                  "fieldRef":{
                     "apiVersion":"v1",
                     "fieldPath":"metadata.annotations['admission.trusted.identity/ti-images']"
                  }
               },
               {
                  "path":"ti-cluster-name",
                  "fieldRef":{
                     "apiVersion":"v1",
                     "fieldPath":"metadata.annotations['admission.trusted.identity/ti-cluster-name']"
                  }
               },
               {
                  "path":"ti-cluster-region",
                  "fieldRef":{
                     "apiVersion":"v1",
                     "fieldPath":"metadata.annotations['admission.trusted.identity/ti-cluster-region']"
                  }
               }
            ],
            "defaultMode":420
         }
      }
   },
   {
      "op":"add",
      "path":"/spec/volumes/-",
      "value":{
         "name":"ti-vault-secret",
         "emptyDir":{

         }
      }
   },
   {
      "op":"add",
      "path":"/spec/volumes/-",
      "value":{
         "name":"ti-keys",
         "hostPath":{
            "path":"/ti/secrets/keys",
            "type":"Directory"
         }
      }
   },
   {
      "op":"add",
      "path":"/spec/volumes/-",
      "value":{
         "name":"ti-skeys",
         "secret":{
            "secretName":"ti-keys-config",
            "defaultMode":420
         }
      }
   },
   {
      "op":"add",
      "path":"/spec/volumes/-",
      "value":{
         "name":"ti-sa-mount",
         "secret":{
            "secretName":"ti-sa-token-4lhck",
            "defaultMode":420
         }
      }
   },
   {
      "op":"add",
      "path":"/spec/containers/0/volumeMounts/-",
      "value":{
         "name":"ti-vault-secret",
         "readOnly":true,
         "mountPath":"/vault-certs"
      }
   },
   {
      "op":"add",
      "path":"/spec/containers/0/volumeMounts/-",
      "value":{
         "name":"jwt-shared-data",
         "readOnly":true,
         "mountPath":"/jwt-tokens"
      }
   }
]
